Brilliant — now let’s make your report dynamic and intelligent, so it reflects real stats from your transaction data and integrates seamlessly with your `/run-agent` endpoint. This means we’ll generate an HTML report template on-the-fly using Python and then convert it into a downloadable PDF. Here’s how we’ll pull it all together 👇

---

## 🧠 Step 1: Dynamic HTML Report from Python

Update `report_generator.py` like this:

```python
import os
from weasyprint import HTML

def generate_html_report(df, cluster_plot_path, html_path):
    avg_amount = df["amount"].mean()
    total_rows = len(df)

    html_content = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset='UTF-8'>
        <title>FinIntelli Report</title>
        <style>
            body {{ font-family: Arial; margin: 40px; }}
            h1 {{ color: #2c3e50; }}
            .metric {{ margin-top: 10px; font-size: 1.2em; }}
            img {{ margin-top: 20px; }}
            .footer {{ font-size: 0.8em; margin-top: 40px; color: #888; }}
        </style>
    </head>
    <body>
        <h1>📊 FinIntelli Report</h1>
        <div class='metric'>Total transactions analyzed: {total_rows}</div>
        <div class='metric'>Average transaction amount: {avg_amount:.2f}</div>
        <img src='{cluster_plot_path}' width='500'>
        <div class='footer'>Generated by FinIntelli Agentic AI © 2025</div>
    </body>
    </html>
    """

    os.makedirs(os.path.dirname(html_path), exist_ok=True)
    with open(html_path, "w", encoding="utf-8") as f:
        f.write(html_content)

def render_pdf(html_path, pdf_path):
    os.makedirs(os.path.dirname(pdf_path), exist_ok=True)
    HTML(html_path).write_pdf(pdf_path)
```

---

## ⚙️ Step 2: Update Pipeline to Wire It Together

Modify `pipeline.py`:

```python
from src.data_loader import load_data
from src.eda import generate_cluster_plot
from src.report_generator import generate_html_report, render_pdf
from src.notifier import send_email, send_telegram

def run_analysis():
    df = load_data()
    plot_path = "outputs/plots/cluster.png"
    html_path = "outputs/reports/summary_report.html"
    pdf_path = "outputs/reports/summary_report.pdf"

    generate_cluster_plot(df, plot_path)
    generate_html_report(df, plot_path, html_path)
    render_pdf(html_path, pdf_path)

    send_email("📩 FinIntelli Report", "Your report is ready.")
    send_telegram("✅ FinIntelli analysis complete. Report sent.")

    return {"pdf_path": pdf_path, "summary": f"{len(df)} rows analyzed"}
```

---

## 🌐 Step 3: Final FastAPI Endpoint

Update `routes.py`:

```python
from fastapi.responses import FileResponse
from src.agents.pipeline import run_analysis

@router.get("/run-agent")
def trigger_agent():
    result = run_analysis()
    pdf_path = result["pdf_path"]

    return FileResponse(pdf_path, media_type="application/pdf", filename="FinIntelli_Report.pdf")
```

---

### 🧪 Try It Live

Run the API:

```bash
uvicorn src.api.app:app --reload
```

Visit:  
📎 [http://127.0.0.1:8000/run-agent](http://127.0.0.1:8000/run-agent)  
✅ Your report will auto-generate based on your data and prompt a clean PDF download.

---

Would you like to expand this into a multi-report system with different endpoints for trend analysis, KYC stats, or risk scoring — each generating their own branded PDFs? Your project has serious potential 🚀📁
